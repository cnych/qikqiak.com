---
title: Kubernetes Pod å·¥ä½œæµ
date: 2018-05-15
tags: ["kubernetes", "Pod"]
keywords: ["kubernetes", "Pod", "workflow", "å·¥ä½œæµ"]
slug: pod-workflow
gitcomment: true
bigimg: [{src: "/img/posts/photo-1497864149936-d3163f0c0f4b.jpeg", desc: "Coloured pencils"}]
category: "kubernetes"
---

æˆ‘ä»¬çŸ¥é“`Pod`æ˜¯`Kubernetes`ä¸­æœ€å°çš„è°ƒåº¦å•å…ƒï¼Œå¹³æ—¶æˆ‘ä»¬æ“ä½œ`Pod`çš„æ—¶é—´ä¹Ÿæ˜¯æœ€å¤šçš„ï¼Œé‚£ä¹ˆä½ çŸ¥é“`Pod`æ˜¯æ€æ ·è¢«åˆ›å»ºå‡ºæ¥çš„å—ï¼ŸçŸ¥é“ä»–çš„å·¥ä½œæµç¨‹å—ï¼Ÿ

<!--more-->

## ç»„ä»¶ä¹‹é—´çš„é€šä¿¡
æˆ‘ä»¬çŸ¥é“åœ¨`Kubernetes`é›†ç¾¤ä¸­`apiserver`æ˜¯æ•´ä¸ªé›†ç¾¤çš„æ§åˆ¶å…¥å£ï¼Œ`etcd`åœ¨é›†ç¾¤ä¸­å……å½“æ•°æ®åº“çš„ä½œç”¨ï¼Œåªæœ‰`apiserver`æ‰å¯ä»¥ç›´æ¥å»æ“ä½œ`etcd`é›†ç¾¤ï¼Œè€Œæˆ‘ä»¬çš„`apiserver`æ— è®ºæ˜¯å¯¹å†…è¿˜æ˜¯å¯¹å¤–éƒ½æä¾›äº†ç»Ÿä¸€çš„`REST API`æœåŠ¡ï¼ŒåŒ…æ‹¬ä¸€ä¸ª**8080**ç«¯å£çš„éå®‰å…¨æœåŠ¡å’Œ**6443**ç«¯å£çš„å®‰å…¨æœåŠ¡ã€‚ç»„ä»¶ä¹‹é—´å½“ç„¶ä¹Ÿæ˜¯é€šè¿‡`apiserver`è¿›è¡Œé€šä¿¡çš„ï¼Œå…¶ä¸­`kube-controller-manager`ã€`kube-scheduler`ã€`kubelet`æ˜¯é€šè¿‡`apiserver watch API`æ¥ç›‘æ§æˆ‘ä»¬çš„èµ„æºå˜åŒ–ï¼Œå¹¶ä¸”å¯¹èµ„æºçš„ç›¸å…³çŠ¶æ€æ›´æ–°æ“ä½œä¹Ÿéƒ½æ˜¯é€šè¿‡`apiserver`è¿›è¡Œçš„ï¼Œæ‰€ä»¥è¯´ç™½äº†ç»„ä»¶ä¹‹é—´çš„é€šä¿¡å°±æ˜¯é€šè¿‡`apiserver REST API`å’Œ`apiserver watch API`è¿›è¡Œçš„ã€‚

## Pod å·¥ä½œæµ
é‚£ä¹ˆæˆ‘ä»¬åˆ›å»º`Pod`çš„æ—¶å€™åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯æ€æ ·åˆ›å»ºæˆåŠŸ`Pod`çš„å‘¢ï¼Ÿ

ä¸‹é¢å›¾ç¤ºå°±æ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„`Pod`å·¥ä½œæµç¨‹å›¾ï¼š
![workflow](/img/posts/pod-workflow.png)

å’Œä¸Šé¢çš„ç»„ä»¶é€šä¿¡ä¸€è‡´ï¼š

* ç¬¬ä¸€æ­¥é€šè¿‡`apiserver REST API`åˆ›å»ºä¸€ä¸ª`Pod`
* ç„¶å`apiserver`æ¥æ”¶åˆ°æ•°æ®åå°†æ•°æ®å†™å…¥åˆ°`etcd`ä¸­
* ç”±äº`kube-scheduler`é€šè¿‡`apiserver watch API`ä¸€ç›´åœ¨ç›‘å¬èµ„æºçš„å˜åŒ–ï¼Œè¿™ä¸ªæ—¶å€™å‘ç°æœ‰ä¸€ä¸ªæ–°çš„`Pod`ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™è¯¥`Pod`è¿˜æ²¡å’Œä»»ä½•`Node`èŠ‚ç‚¹è¿›è¡Œç»‘å®šï¼Œæ‰€ä»¥`kube-scheduler`å°±ç»è¿‡ä¸€ç³»åˆ—å¤æ‚çš„è°ƒåº¦ç­–ç•¥ï¼Œé€‰æ‹©å‡ºä¸€ä¸ªåˆé€‚çš„`Node`èŠ‚ç‚¹ï¼Œå°†è¯¥`Pod`å’Œè¯¥ç›®æ ‡`Node`è¿›è¡Œç»‘å®šï¼Œå½“ç„¶ä¹Ÿä¼šæ›´æ–°åˆ°`etcd`ä¸­å»çš„
* è¿™ä¸ªæ—¶å€™ä¸€æ ·çš„ç›®æ ‡`Node`èŠ‚ç‚¹ä¸Šçš„`kubelet`é€šè¿‡`apiserver watch API`æ£€æµ‹åˆ°æœ‰ä¸€ä¸ªæ–°çš„`Pod`è¢«è°ƒåº¦è¿‡æ¥äº†ï¼Œä»–å°±å°†è¯¥`Pod`çš„ç›¸å…³æ•°æ®ä¼ é€’ç»™åé¢çš„å®¹å™¨è¿è¡Œæ—¶(`container runtime`)ï¼Œæ¯”å¦‚`Docker`ï¼Œè®©ä»–ä»¬å»è¿è¡Œè¯¥`Pod`
* è€Œä¸”`kubelet`è¿˜ä¼šé€šè¿‡`container runtime`è·å–`Pod`çš„çŠ¶æ€ï¼Œç„¶åæ›´æ–°åˆ°`apiserver`ä¸­ï¼Œå½“ç„¶æœ€åä¹Ÿæ˜¯å†™å…¥åˆ°`etcd`ä¸­å»çš„ã€‚

è¿™æ ·ä¸€ä¸ªå…¸å‹çš„`Pod`å·¥ä½œæµå°±å®Œæˆäº†ï¼Œé€šè¿‡è¿™ä¸ªæµç¨‹æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ•´ä¸ªè¿‡ç¨‹ä¸­æœ€é‡è¦çš„å°±æ˜¯`apiserver watch API`å’Œ`kube-scheduler`çš„è°ƒåº¦ç­–ç•¥ã€‚

## å¹¿å‘Š
å¦å¤–æˆ‘ä¹Ÿ`æ— è€»åœ°`ğŸ¤ªç»™å¤§å®¶æ¨èä¸€ä¸ªæˆ‘çš„è¯¾ç¨‹ï¼š[ä» Docker åˆ° Kubernetes è¿›é˜¶](https://www.haimaxy.com/course/6n8xd6/?utm_source=blog)ğŸ˜˜ï¼Œå­¦å®Œæœ¬è¯¾ç¨‹ä»¥åï¼Œä½ å°†ä¼šå¯¹`Docker`å’Œ `Kubernetes`æœ‰ä¸€ä¸ªæ›´åŠ æ·±å…¥çš„è®¤è¯†ï¼Œæˆ‘ä»¬ä¼šè®²åˆ° Docker çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•ï¼Œå½“ç„¶æˆ‘ä»¬çš„é‡ç‚¹ä¼šåœ¨ Kubernetes ä¸Šé¢ï¼Œä¼šç”¨ `kubeadm` æ¥æ­å»ºä¸€å¥— Kubernetes çš„é›†ç¾¤ï¼Œç†è§£ Kubernetes é›†ç¾¤çš„è¿è¡ŒåŸç†ï¼Œå¸¸ç”¨çš„ä¸€äº›æ§åˆ¶å™¨ä½¿ç”¨æ–¹æ³•ã€è¿˜æœ‰ Kubernetes çš„ä¸€äº›è°ƒåº¦ç­–ç•¥ã€Kubernetes çš„è¿ç»´ã€åŒ…ç®¡ç†å·¥å…· `Helm` çš„ä½¿ç”¨ä»¥åŠæœ€åæˆ‘ä»¬ä¼šå®ç°åŸºäº Kubernetes çš„ `CI/CD`ã€‚
[![è¯¾ç¨‹](http://sdn.haimaxy.com/covers/2018/4/21/c4082e0f09c746aa848279a2567cffed.png)](https://www.haimaxy.com/course/6n8xd6/?utm_source=blog)


æ‰«æä¸‹é¢çš„äºŒç»´ç (æˆ–å¾®ä¿¡æœç´¢`k8sæŠ€æœ¯åœˆ`)å…³æ³¨æˆ‘ä»¬çš„å¾®ä¿¡å…¬ä¼—å¸å·ï¼Œåœ¨å¾®ä¿¡å…¬ä¼—å¸å·ä¸­å›å¤ **åŠ ç¾¤** å³å¯åŠ å…¥åˆ°æˆ‘ä»¬çš„ kubernetes è®¨è®ºç¾¤é‡Œé¢å…±åŒå­¦ä¹ ã€‚
![qrcode](/img/posts/qrcode_for_gh_d6dd87b6ceb4_430.jpg)


