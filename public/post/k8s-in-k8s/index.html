<!DOCTYPE html>
<html lang="zh">
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">


  <title>åœ¨ Kubernetes ä¸­è¿è¡Œ Kubernetes-é˜³æ˜çš„åšå®¢|Kubernetes|Istio|Prometheus|Python|Golang|äº‘åŸç”Ÿ</title>
  <meta property="og:title" content="åœ¨ Kubernetes ä¸­è¿è¡Œ Kubernetes" />
  <meta name="twitter:title" content="åœ¨ Kubernetes ä¸­è¿è¡Œ Kubernetes" />

  <meta name="description" content="å‰é¢å…¶å®æˆ‘ä»¬åœ¨ Windows ç³»ç»Ÿçš„ WSL2 ä¸‹é¢ä½¿ç”¨ KinD æ­å»ºäº†ä¸€å¥— Kubernetes é›†ç¾¤ï¼ŒKinD æ˜¯ä¸€ä¸ªéå¸¸è½»é‡çº§çš„ Kubernetes å®‰è£…å·¥å…·ï¼Œä»–å°† Docker å®¹å™¨å½“æˆ Kubernetes çš„èŠ‚ç‚¹ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ã€‚æ—¢ç„¶åœ¨ Docker å®¹å™¨ä¸­å¯ä»¥è¿è¡Œ Kubernetes é›†ç¾¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‡ªç„¶å°±ä¼šæƒ³åˆ°æ˜¯å¦å¯ä»¥åœ¨ Pod ä¸­æ¥è¿è¡Œå‘¢ï¼Ÿåœ¨ Pod ä¸­è¿è¡Œä¼šé‡åˆ°å“ªäº›é—®é¢˜å‘¢ï¼Ÿ">
  <meta property="og:description" content="å‰é¢å…¶å®æˆ‘ä»¬åœ¨ Windows ç³»ç»Ÿçš„ WSL2 ä¸‹é¢ä½¿ç”¨ KinD æ­å»ºäº†ä¸€å¥— Kubernetes é›†ç¾¤ï¼ŒKinD æ˜¯ä¸€ä¸ªéå¸¸è½»é‡çº§çš„ Kubernetes å®‰è£…å·¥å…·ï¼Œä»–å°† Docker å®¹å™¨å½“æˆ Kubernetes çš„èŠ‚ç‚¹ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ã€‚æ—¢ç„¶åœ¨ Docker å®¹å™¨ä¸­å¯ä»¥è¿è¡Œ Kubernetes é›†ç¾¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‡ªç„¶å°±ä¼šæƒ³åˆ°æ˜¯å¦å¯ä»¥åœ¨ Pod ä¸­æ¥è¿è¡Œå‘¢ï¼Ÿåœ¨ Pod ä¸­è¿è¡Œä¼šé‡åˆ°å“ªäº›é—®é¢˜å‘¢ï¼Ÿ">
  <meta name="twitter:description" content="å‰é¢å…¶å®æˆ‘ä»¬åœ¨ Windows ç³»ç»Ÿçš„ WSL2 ä¸‹é¢ä½¿ç”¨ KinD æ­å»ºäº†ä¸€å¥— Kubernetes é›†ç¾¤ï¼ŒKinD æ˜¯ä¸€ä¸ªéå¸¸è½»é‡çº§çš„ Kubernetes å®‰è£…å·¥å…·ï¼Œä»–å°† Docker å®¹å™¨å½“æˆ Kubernetes çš„èŠ‚ç‚¹ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ã€‚æ—¢ç„¶åœ¨ Docker å®¹å™¨ä¸­å¯ä»¥è¿è¡Œ Kubernetes é›†ç¾¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‡ªç„¶å°±ä¼šæƒ³åˆ°æ˜¯å¦å¯ä»¥åœ¨ Pod ä¸­æ¥è¿è¡Œå‘¢ï¼Ÿåœ¨ Pod ä¸­è¿è¡Œä¼šé‡åˆ°å“ªäº›é—®é¢˜å‘¢ï¼Ÿ">
  <meta name="author" content=""/>
  <link href="https://picdn.youdianzhishi.com/images/blog-favicon.png" rel="icon" type="image/x-icon" />
  <link rel="apple-touch-icon" href="https://picdn.youdianzhishi.com/images/blog-favicon.png"/>
  <meta property="og:image" content="https://picdn.youdianzhishi.com/images/blog-favicon.png" />
  <meta name="twitter:image" content="https://picdn.youdianzhishi.com/images/blog-favicon.png" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://www.qikqiak.com/post/k8s-in-k8s/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="é˜³æ˜çš„åšå®¢" />

  <link rel="canonical" href="https://www.qikqiak.com/post/k8s-in-k8s/" />
  <link rel="alternate" href="https://www.qikqiak.com/index.xml" type="application/rss+xml" title="é˜³æ˜çš„åšå®¢">

  
  
  <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700%7COpen+Sans:400,700" rel="stylesheet">
  

  <link rel="stylesheet" href='https://www.qikqiak.com/css/bundle.min.a6b62363fe57848ad01efa2a5d1bbb1047c2ffb71b53d8aeb42bc5ed5c77ea7c.css' integrity='sha256-prYjY/5XhIrQHvoqXRu7EEfC/7cbU9iutCvF7Vx36nw='>

  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
  
  
    
    <!--[if lt IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <![endif]-->
<meta name="google-site-verification" content="oKxX4fOvB2yYmU02txZFChM93XQbESU4JaG3tNH9Hm8" />
<meta name="baidu-site-verification" content="F5ojAyqaKU" />
<meta name="keywords" content="kubernetes, windows, wsl, kind, cgroup">
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d611849735f187dd788dc054908f7d7a";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-69668147-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">åˆ‡æ¢å¯¼èˆª</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://www.qikqiak.com/" title="é˜³æ˜çš„åšå®¢">
        <img src="https://picdn.youdianzhishi.com/images/blog-logo-new.png" style="margin-top: -5px;height: 32px;" alt="é˜³æ˜çš„åšå®¢">
      </a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="é¦–é¡µ" href="https://www.qikqiak.com/">é¦–é¡µ</a>
            </li>
          
        
          
            <li>
              <a title="è¯¾ç¨‹" href="https://youdianzhishi.com/?utm_source=blog&amp;utm_campaign=referral&amp;utm_medium=topmenu">è¯¾ç¨‹</a>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">æ–‡ç« åˆ†ç±»</a>
              <div class="navlinks-children">
                
                  <a href="https://www.qikqiak.com/archives">Archive</a>
                
                  <a href="https://www.qikqiak.com/tags">tags</a>
                
                  <a href="https://www.qikqiak.com/tags/kubernetes">kubernetes</a>
                
                  <a href="https://www.qikqiak.com/tags/python">python</a>
                
                  <a href="https://www.qikqiak.com/tags/django">django</a>
                
                  <a href="https://www.qikqiak.com/tags/devops">devops</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">ä¹¦ç±</a>
              <div class="navlinks-children">
                
                  <a href="https://www.qikqiak.com/k8s-book/">k8sè¿›é˜¶æ‰‹å†Œ</a>
                
                  <a href="https://www.qikqiak.com/istio-book/">ä¸€èµ·å­¦istio</a>
                
                  <a href="https://www.qikqiak.com/tdd-book/">Pythonå¾®æœåŠ¡</a>
                
                  <a href="https://md.qikqiak.com/">Markdownå¾®ä¿¡</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="å…³äº" href="https://www.qikqiak.com/page/about/">å…³äº</a>
            </li>
          
        
          
            <li>
              <a title="RSS" href="https://www.qikqiak.com/index.xml">RSS</a>
            </li>
          
        

        

        

        
          <li>
            <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch" style="outline: none;">
              <span id="searchGlyph" class="glyphicon glyphicon-search"></span>
            </a>
          </li>
          

      </ul>
    </div>

  </div>
</nav>


  <div id="modalSearch" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">æœç´¢</h4>
        </div>
        <div class="modal-body">
            
<div class="aa-input-container" id="aa-input-container">
    <input type="search" id="aa-search-input" class="aa-input-search" placeholder="Search for titles or URIs..." name="search" autocomplete="off" />
    <svg class="aa-input-icon" viewBox="654 -372 1664 1664">
        <path d="M1806,332c0-123.3-43.8-228.8-131.5-316.5C1586.8-72.2,1481.3-116,1358-116s-228.8,43.8-316.5,131.5  C953.8,103.2,910,208.7,910,332s43.8,228.8,131.5,316.5C1129.2,736.2,1234.7,780,1358,780s228.8-43.8,316.5-131.5  C1762.2,560.8,1806,455.3,1806,332z M2318,1164c0,34.7-12.7,64.7-38,90s-55.3,38-90,38c-36,0-66-12.7-90-38l-343-342  c-119.3,82.7-252.3,124-399,124c-95.3,0-186.5-18.5-273.5-55.5s-162-87-225-150s-113-138-150-225S654,427.3,654,332  s18.5-186.5,55.5-273.5s87-162,150-225s138-113,225-150S1262.7-372,1358-372s186.5,18.5,273.5,55.5s162,87,225,150s113,138,150,225  S2062,236.7,2062,332c0,146.7-41.3,279.7-124,399l343,343C2305.7,1098.7,2318,1128.7,2318,1164z" />
    </svg>
</div>
<script src="https://www.qikqiak.com/js/algoliasearch.min.js"></script>
<script src="https://www.qikqiak.com/js/autocomplete.min.js"></script>

<script>
var client = algoliasearch("1JDRAS0AZR", "8804ac109158bb3bb60d74ce98fa332f");
var index = client.initIndex('prod_blog');

autocomplete('#aa-search-input',
{ hint: false}, {
    source: autocomplete.sources.hits(index, {hitsPerPage: 5}),
    
    displayKey: 'name',
    
    templates: {
        
        suggestion: function(suggestion) {
            return '<span>' + '<a href="https://www.qikqiak.com/post/' + suggestion.slug + '">' +
            suggestion._highlightResult.title.value + '</a></span>';
        }
    }
});
</script>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">close</button>
        </div>
      </div>
    </div>
  </div>

    
  
  
  




  
    <div id="header-big-imgs" data-num-img=1 data-img-src-1="https://picdn.youdianzhishi.com/images/20200612120656.png" data-img-desc-1="Kubernetes IN Kubernetes"></div>
  

  <header class="header-section has-img">
    
      <div class="intro-header big-img">
        
        <div class="container">
          <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <div class="post-heading">
                <h1>åœ¨ Kubernetes ä¸­è¿è¡Œ Kubernetes</h1>
                  
                  
                    <span class="post-meta">
  å‘è¡¨äº June 12, 2020  
</span>

                  
              </div>
            </div>
          </div>
        </div>
        <span class="img-desc" style="display: inline;"></span>
      </div>
    
    
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>åœ¨ Kubernetes ä¸­è¿è¡Œ Kubernetes</h1>
                
                
                  <span class="post-meta">
  å‘è¡¨äº June 12, 2020  
</span>

                
            </div>
          </div>
        </div>
      </div>
    </div>
    
    
  </header>


    



<div class="container" role="main">
  <div class="row">

    
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div>
            
            
            <h5 id="tags" style="margin-top: 30px;">æ ‡ç­¾:
              
                  <a href="https://www.qikqiak.com/tags/kubernetes/">kubernetes</a> &nbsp;
              
                  <a href="https://www.qikqiak.com/tags/wsl/">wsl</a> &nbsp;
              
                  <a href="https://www.qikqiak.com/tags/kind/">kind</a> &nbsp;
              
                  <a href="https://www.qikqiak.com/tags/docker/">docker</a> &nbsp;
              
            </h5>
            
        </div>
  
        <article role="main" class="blog-post" itemprop="articleBody" id="content">
          
            
<aside class="toc">
  <nav id="TableOfContents">
  <ul>
    <li><a href="#åœ¨-pod-ä¸­å®‰è£…-docker-daemon">åœ¨ Pod ä¸­å®‰è£… Docker Daemon</a>
      <ul>
        <li><a href="#pid-1-çš„é—®é¢˜">PID 1 çš„é—®é¢˜</a></li>
        <li><a href="#æŒ‚è½½-cgroups">æŒ‚è½½ cgroups</a></li>
        <li><a href="#iptables">IPtables</a></li>
      </ul>
    </li>
    <li><a href="#åœ¨-pod-ä¸­è¿è¡Œ-kind">åœ¨ Pod ä¸­è¿è¡Œ KinD</a></li>
    <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
  </ul>
</nav>
</aside>

          
  
          
          
          
  
          
          
          
  
          
          
          

          <p><a href="https://www.qikqiak.com/post/deploy-k8s-on-win-use-wsl2/">å‰é¢å…¶å®æˆ‘ä»¬åœ¨ Windows ç³»ç»Ÿçš„ WSL2 ä¸‹é¢ä½¿ç”¨ KinD æ­å»ºäº†ä¸€å¥— Kubernetes é›†ç¾¤</a>ï¼ŒKinD æ˜¯ä¸€ä¸ªéå¸¸è½»é‡çº§çš„ Kubernetes å®‰è£…å·¥å…·ï¼Œä»–å°† Docker å®¹å™¨å½“æˆ Kubernetes çš„èŠ‚ç‚¹ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ã€‚æ—¢ç„¶åœ¨ Docker å®¹å™¨ä¸­å¯ä»¥è¿è¡Œ Kubernetes é›†ç¾¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‡ªç„¶å°±ä¼šæƒ³åˆ°æ˜¯å¦å¯ä»¥åœ¨ Pod ä¸­æ¥è¿è¡Œå‘¢ï¼Ÿåœ¨ Pod ä¸­è¿è¡Œä¼šé‡åˆ°å“ªäº›é—®é¢˜å‘¢ï¼Ÿ</p>
<h2 id="åœ¨-pod-ä¸­å®‰è£…-docker-daemon">åœ¨ Pod ä¸­å®‰è£… Docker Daemon</h2>
<p>KinD ç°åœ¨æ˜¯ä¾èµ–ä¸ Docker çš„ï¼Œæ‰€ä»¥é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå…è®¸æˆ‘ä»¬åœ¨ Pod ä¸­è¿è¡Œ Docker Deamon çš„é•œåƒï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ Pod é‡Œé¢å»æ‰§è¡Œ <code>docker run</code> è¿™æ ·çš„å‘½ä»¤ï¼Œå½“ç„¶è¿™ä¸ªå’Œæˆ‘ä»¬ä¹‹å‰è¯´çš„æŒ‚è½½å®¿ä¸»æœºçš„ docker.sock è¿™ç§ DIND æ¨¡å¼æ˜¯ä¸ä¸€æ ·çš„ã€‚è¦æƒ³åœ¨ Pod ä¸­è¿è¡Œ Docker Deamon ä¾ç„¶ä¼šæœ‰ä¸å°‘é—®é¢˜çš„ã€‚</p>
<h3 id="pid-1-çš„é—®é¢˜">PID 1 çš„é—®é¢˜</h3>
<p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªå®¹å™¨ä¸­å»è¿è¡Œ Docker Daemon ä»¥åŠä¸€äº› Kubernetes çš„é›†ç¾¤æµ‹è¯•ï¼Œè€Œè¿™äº›æµ‹è¯•ä¾èµ–äº KinD å’Œ Docker Damonï¼Œåœ¨ä¸€ä¸ªå®¹å™¨ä¸­è¿è¡Œå¤šä¸ªæœåŠ¡æˆ‘ä»¬å¯èƒ½ä¼šå»ä½¿ç”¨ systemdï¼Œä½†æ˜¯ä½¿ç”¨ systemd ä¹Ÿä¼šæœ‰ä¸€äº›é—®é¢˜ã€‚</p>
<ol>
<li>æ¯”å¦‚æˆ‘ä»¬éœ€è¦ä¿ç•™æµ‹è¯•çš„é€€å‡ºçŠ¶æ€ï¼ŒKubernetes ä¸­ä½¿ç”¨çš„å®¹å™¨è¿è¡Œæ—¶å¯ä»¥ watch åˆ°å®¹å™¨ä¸­çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼ˆPID 1ï¼‰çš„é€€å‡ºçŠ¶æ€ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ systemd çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æµ‹è¯•çš„è¿›ç¨‹é€€å‡ºçŠ¶æ€ä¸ä¼šè¢«è½¬å‘åˆ° Kubernetesã€‚</li>
<li>æ­¤å¤–è·å–æµ‹è¯•çš„æ—¥å¿—ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ï¼Œåœ¨ Kubernetes ä¸­ä¼šè‡ªåŠ¨è·å–å†™å…¥åˆ° stdout å’Œ stderr çš„å®¹å™¨æ—¥å¿—ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨ systemd çš„è¯ï¼Œè¦æƒ³è·å–åº”ç”¨çš„æ—¥å¿—å°±æ¯”è¾ƒéº»çƒ¦çš„ã€‚</li>
</ol>
<p>ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®¹å™¨é•œåƒä¸­ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„å¯åŠ¨è„šæœ¬ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>dockerd &amp;
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Wait until dockerd is ready.</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">until</span> docker ps &gt;/dev/null 2&gt;&amp;<span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Waiting for dockerd...&#34;</span>
</span></span><span style="display:flex;"><span>  sleep <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">done</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">exec</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$@</span><span style="color:#f1fa8c">&#34;</span>
</span></span></code></pre></div><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬ä¸èƒ½å°†ä¸Šé¢çš„è„šæœ¬ä½œä¸ºå®¹å™¨çš„ entrypointï¼Œåœ¨é•œåƒä¸­å®šä¹‰çš„ entrypoint ä¼šåœ¨å®¹å™¨ä¸­ä»¥ PID 1 çš„å½¢å¼è¿è¡Œåœ¨ä¸€ä¸ªå•ç‹¬çš„ pid namespace ä¸­ã€‚PID 1 æ˜¯ä¸€ä¸ªå†…æ ¸ä¸­çš„ä¸€ä¸ªç‰¹æ®Šè¿›ç¨‹ï¼Œå®ƒçš„è¡Œä¸ºå’Œå…¶ä»–è¿›ç¨‹ä¸åŒã€‚</p>
<p>æœ¬è´¨ä¸Šï¼Œæ¥æ”¶ä¿¡å·çš„è¿›ç¨‹æ˜¯ PID 1ï¼šå®ƒä¼šè¢«å†…æ ¸åšç‰¹æ®Šå¤„ç†ï¼›å¦‚æœå®ƒæ²¡æœ‰ä¸ºä¿¡å·æ³¨å†Œä¸€ä¸ªå¤„ç†å™¨ï¼Œå†…æ ¸å°±ä¸ä¼šå›åˆ°é»˜è®¤è¡Œä¸ºï¼ˆå³æ€æ­»è¿›ç¨‹ï¼‰ã€‚ç”±äºå½“æ”¶åˆ° <code>SIGTERM</code> ä¿¡å·æ—¶ï¼Œå†…æ ¸ä¼šé»˜è®¤æ€æ­»è¿™ä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥ä¸€äº›è¿›ç¨‹ä¹Ÿè®¸ä¸ä¼šä¸º <code>SIGTERM</code> ä¿¡å·æ³¨å†Œä¿¡å·å¤„ç†ç¨‹åºã€‚å¦‚æœå‡ºç°äº†è¿™ç§æƒ…å†µï¼Œå½“ Kubernetes å°è¯•ç»ˆæ­¢ Pod æ—¶ï¼ŒSIGTERM å°†è¢«åå™¬ï¼Œä½ ä¼šæ³¨æ„åˆ° Pod ä¼šè¢«å¡åœ¨ <code>Terminating</code> çš„çŠ¶æ€ä¸‹ã€‚</p>
<p>è¿™å…¶å®ä¸æ˜¯ä¸€ä¸ªä»€ä¹ˆæ–°é²œçš„é—®é¢˜ï¼Œä½†æ˜¯äº†è§£è¿™ä¸ªé—®é¢˜çš„äººå´å¹¶ä¸å¤šï¼Œè€Œä¸”è¿˜ä¸€ç›´åœ¨æ„å»ºæœ‰è¿™æ ·é—®é¢˜çš„å®¹å™¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://github.com/krallin/tini">tini</a> è¿™ä¸ªåº”ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°†å…¶ä½œä¸ºé•œåƒçš„å…¥å£ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ENTRYPOINT <span style="color:#ff79c6">[</span><span style="color:#f1fa8c">&#34;/usr/bin/tini&#34;</span>, <span style="color:#f1fa8c">&#34;--&#34;</span>, <span style="color:#f1fa8c">&#34;/entrypoint.sh&#34;</span><span style="color:#ff79c6">]</span>
</span></span></code></pre></div><p>è¿™ä¸ªç¨‹åºä¼šæ­£ç¡®æ³¨å†Œä¿¡å·å¤„ç†ç¨‹åºå’Œè½¬å‘ä¿¡å·ã€‚å®ƒè¿˜ä¼šæ‰§è¡Œä¸€äº›å…¶ä»– PID 1 çš„äº‹æƒ…ï¼Œæ¯”å¦‚å›æ”¶å®¹å™¨ä¸­çš„åƒµå°¸è¿›ç¨‹ã€‚</p>
<h3 id="æŒ‚è½½-cgroups">æŒ‚è½½ cgroups</h3>
<p>ç”±äº Docker Daemon éœ€è¦æ§åˆ¶ cgroupsï¼Œæ‰€ä»¥éœ€è¦å°† cgroup æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°å®¹å™¨ä¸­å»ã€‚ä½†æ˜¯ç”±äº cgroups å’Œå®¿ä¸»æœºæ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç¡®ä¿ Docker Daemon æ§åˆ¶çš„ cgroups ä¸ä¼šå½±å“åˆ°å…¶ä»–å®¹å™¨æˆ–è€…å®¿ä¸»æœºè¿›ç¨‹ä½¿ç”¨çš„å…¶ä»– cgroupsï¼Œè¿˜éœ€è¦ç¡®ä¿ Docker Daemon åœ¨å®¹å™¨ä¸­åˆ›å»ºçš„ cgroups åœ¨å®¹å™¨é€€å‡ºåä¸ä¼šè¢«æ³„éœ²ã€‚</p>
<p>Docker Daemon ä¸­æœ‰ä¸€ä¸ª<code>--cgroupâ€”parent</code> å‚æ•°æ¥å‘Šè¯‰ Daemon å°†æ‰€æœ‰å®¹å™¨çš„ cgroups åµŒå¥—åœ¨æŒ‡å®šçš„ cgroup ä¸‹é¢ã€‚å½“å®¹å™¨è¿è¡Œåœ¨ Kubernetes é›†ç¾¤ä¸‹é¢æ—¶ï¼Œæˆ‘ä»¬åœ¨å®¹å™¨ä¸­è®¾ç½® Docker Daemon çš„<code>--cgroupâ€”parent</code> å‚æ•°ï¼Œè¿™æ ·å®ƒçš„æ‰€æœ‰ cgroups å°±ä¼šè¢«åµŒå¥—åœ¨ Kubernetes ä¸ºå®¹å™¨åˆ›å»ºçš„ cgroup ä¸‹é¢äº†ã€‚</p>
<p>åœ¨ä»¥å‰ä¸ºäº†è®© cgroup æ–‡ä»¶ç³»ç»Ÿåœ¨å®¹å™¨ä¸­å¯ç”¨ï¼Œä¸€äº›ç”¨æˆ·ä¼šå°†å®¿ä¸»æœºä¸­çš„ <code>/sys/fs/cgroup</code> æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„è¿™ä¸ªä½ç½®ï¼Œå¦‚æœè¿™æ ·ä½¿ç”¨çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨å®¹å™¨å¯åŠ¨è„šæœ¬ä¸­æŠŠ<code>--cgroupâ€”parent</code> è®¾ç½®ä¸ºä¸‹é¢çš„å†…å®¹ï¼Œè¿™æ · Docker Daemon åˆ›å»ºçš„ cgroups å°±å¯ä»¥æ­£ç¡®è¢«åµŒå¥—äº†ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">CGROUP_PARENT</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">$(</span>grep systemd /proc/self/cgroup | cut -d: -f3<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">/docker&#34;</span>
</span></span></code></pre></div><blockquote>
<p>æ³¨æ„ï¼š<code>/proc/self/cgroup</code> æ˜¾ç¤ºçš„æ˜¯è°ƒç”¨è¿›ç¨‹çš„ cgorup è·¯å¾„ã€‚</p>
</blockquote>
<p>ä½†æ˜¯æˆ‘ä»¬è¦çŸ¥é“ï¼ŒæŒ‚è½½å®¿ä¸»æœºçš„ <code>/sys/fs/cgroup</code> æ–‡ä»¶æ˜¯éå¸¸å±é™©çš„äº‹æƒ…ï¼Œå› ä¸ºä»–æŠŠæ•´ä¸ªå®¿ä¸»æœºçš„ cgroup å±‚æ¬¡ç»“æ„éƒ½æš´éœ²ç»™äº†å®¹å™¨ã€‚ä»¥å‰ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒDocker ç”¨äº†ä¸€ä¸ªå°æŠ€å·§æŠŠä¸ç›¸å…³çš„ cgroups éšè—èµ·æ¥ï¼Œä¸è®©å®¹å™¨çœ‹åˆ°ã€‚Docker ä»å®¹å™¨çš„ cgroups å¯¹æ¯ä¸ª cgroup ç³»ç»Ÿçš„ cgroup å±‚æ¬¡ç»“æ„çš„æ ¹éƒ¨è¿›è¡Œç»‘å®šæŒ‚è½½ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run --rm debian findmnt -lo source,target -t cgroup
</span></span><span style="display:flex;"><span>SOURCE                                                                               TARGET
</span></span><span style="display:flex;"><span>cpuset<span style="color:#ff79c6">[</span>/docker/451b803b3cd7cd2b69dde64cd833fdd799ae16f9d2d942386ec382f6d55bffac<span style="color:#ff79c6">]</span>     /sys/fs/cgroup/cpuset
</span></span><span style="display:flex;"><span>cpu<span style="color:#ff79c6">[</span>/docker/451b803b3cd7cd2b69dde64cd833fdd799ae16f9d2d942386ec382f6d55bffac<span style="color:#ff79c6">]</span>        /sys/fs/cgroup/cpu
</span></span><span style="display:flex;"><span>cpuacct<span style="color:#ff79c6">[</span>/docker/451b803b3cd7cd2b69dde64cd833fdd799ae16f9d2d942386ec382f6d55bffac<span style="color:#ff79c6">]</span>    /sys/fs/cgroup/cpuacct
</span></span><span style="display:flex;"><span>blkio<span style="color:#ff79c6">[</span>/docker/451b803b3cd7cd2b69dde64cd833fdd799ae16f9d2d942386ec382f6d55bffac<span style="color:#ff79c6">]</span>     /sys/fs/cgroup/blkio
</span></span><span style="display:flex;"><span>memory<span style="color:#ff79c6">[</span>/docker/451b803b3cd7cd2b69dde64cd833fdd799ae16f9d2d942386ec382f6d55bffac<span style="color:#ff79c6">]</span>     /sys/fs/cgroup/memory
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cgroup<span style="color:#ff79c6">[</span>/docker/451b803b3cd7cd2b69dde64cd833fdd799ae16f9d2d942386ec382f6d55bffac<span style="color:#ff79c6">]</span>     /sys/fs/cgroup/systemd
</span></span></code></pre></div><p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡º cgroups é€šè¿‡å°†å®¿ä¸»æœº cgroup æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ <code>/sys/fs/cgroup/memory/memory.limit_in_bytes</code> æ–‡ä»¶æ˜ å°„åˆ° <code>/sys/fs/cgroup/memory/docker/&lt;CONTAINER_ID&gt;/memory.limit_in_bytes</code> æ¥æ§åˆ¶å®¹å™¨å†… cgroup å±‚æ¬¡ç»“æ„æ ¹éƒ¨çš„æ–‡ä»¶ï¼Œè¿™ç§æ–¹å¼å¯ä»¥é˜²æ­¢å®¹å™¨è¿›ç¨‹æ„å¤–åœ°ä¿®æ”¹å®¿ä¸»æœºçš„ cgroupã€‚</p>
<p>ä½†æ˜¯è¿™ç§æ–¹å¼æœ‰æ—¶å€™ä¼šè®© cadvisor å’Œ kubelet è¿™æ ·çš„åº”ç”¨æ„ŸåŠ¨å›°æƒ‘ï¼Œå› ä¸ºç»‘å®šæŒ‚è½½å¹¶ä¸ä¼šæ”¹å˜ <code>/proc/&lt;PID&gt;/cgroup</code> é‡Œé¢çš„å†…å®¹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run --rm debian cat /proc/1/cgroup
</span></span><span style="display:flex;"><span>14:name<span style="color:#ff79c6">=</span>systemd:/docker/512f6b62e3963f85f5abc09b69c370d27ab1dc56549fa8afcbb86eec8663a141
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>5:memory:/docker/512f6b62e3963f85f5abc09b69c370d27ab1dc56549fa8afcbb86eec8663a141
</span></span><span style="display:flex;"><span>4:blkio:/docker/512f6b62e3963f85f5abc09b69c370d27ab1dc56549fa8afcbb86eec8663a141
</span></span><span style="display:flex;"><span>3:cpuacct:/docker/512f6b62e3963f85f5abc09b69c370d27ab1dc56549fa8afcbb86eec8663a141
</span></span><span style="display:flex;"><span>2:cpu:/docker/512f6b62e3963f85f5abc09b69c370d27ab1dc56549fa8afcbb86eec8663a141
</span></span><span style="display:flex;"><span>1:cpuset:/docker/512f6b62e3963f85f5abc09b69c370d27ab1dc56549fa8afcbb86eec8663a141
</span></span><span style="display:flex;"><span>0::/
</span></span></code></pre></div><p>cadvisor ä¼šé€šè¿‡æŸ¥çœ‹ <code>/proc/&lt;PID&gt;/cgroup</code> æ¥è·å–ç»™å®šè¿›ç¨‹çš„ cgroupï¼Œå¹¶å°è¯•ä»å¯¹åº”çš„ cgroup ä¸­è·å– CPU æˆ–å†…å­˜ç»Ÿè®¡æ•°æ®ã€‚ä½†æ˜¯ç”±äº Docker Daemon è¿›ç¨‹åšäº†ç»‘å®šæŒ‚è½½ï¼Œcadvisor å°±æ— æ³•æ‰¾æ‰“å®¹å™¨è¿›ç¨‹å¯¹åº”çš„ cgroupã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨å®¹å™¨å†…éƒ¨åˆåšäº†ä¸€æ¬¡æŒ‚è½½ï¼Œä» <code>/sys/fs/cgroup/memory</code> æŒ‚è½½åˆ° <code>/sys/fs/cgroup/memory/docker/&lt;CONTAINER_ID&gt;/</code>ï¼ˆé’ˆå¯¹æ‰€æœ‰çš„ cgroup å­ç³»ç»Ÿï¼‰ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ç°åœ¨æ–°çš„è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨ <a href="http://man7.org/linux/man-pages/man7/cgroup_namespaces.7.html">cgroup namespace</a>ï¼Œå¦‚æœä½ è¿è¡Œåœ¨ä¸€ä¸ªå†…æ ¸ç‰ˆæœ¬ 4.6+ çš„ Linux ç³»ç»Ÿä¸‹é¢ï¼Œrunc å’Œ docker éƒ½åŠ å…¥äº† cgroup å‘½åç©ºé—´çš„æ”¯æŒã€‚ä½†æ˜¯ç›®å‰ Kubernetes æš‚æ—¶è¿˜ä¸æ”¯æŒ cgroup å‘½åç©ºé—´ï¼Œä½†æ˜¯å¾ˆå¿«ä¼šä½œä¸º <a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-node/20191118-cgroups-v2.md">cgroups v2 æ”¯æŒ</a>çš„ä¸€éƒ¨åˆ†ã€‚</p>
<h3 id="iptables">IPtables</h3>
<p>åœ¨ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬å‘ç°åœ¨çº¿ä¸Šçš„ Kubernetes é›†ç¾¤è¿è¡Œæ—¶ï¼Œæœ‰æ—¶å€™å®¹å™¨å†…çš„ Docker Daemon å¯åŠ¨çš„åµŒå¥—å®¹å™¨æ— æ³•è®¿é—®å¤–ç½‘ï¼Œä½†æ˜¯åœ¨æœ¬åœ°å¼€å‘ç”µè„‘ä¸Šå´å¯ä»¥å¾ˆæ­£å¸¸çš„å·¥ä½œï¼Œå¤§éƒ¨åˆ†å¼€å‘è€…åº”è¯¥éƒ½ä¼šç»å¸¸é‡åˆ°è¿™ç§æƒ…å†µã€‚</p>
<p>æœ€åå‘ç°å½“å‡ºç°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œæ¥è‡ªåµŒå¥—çš„ Docker å®¹å™¨çš„æ•°æ®åŒ…å¹¶æ²¡æœ‰æ‰“åˆ° iptables çš„ POSTROUTING é“¾ï¼Œæ‰€ä»¥æ²¡æœ‰åš masqueradedã€‚</p>
<!-- raw HTML omitted -->
<p>è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºåŒ…å« Docker Daemon çš„é•œåƒæ˜¯åŸºäº <a href="https://www.debian.org/releases/buster/">Debian buster</a> çš„ï¼Œè€Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒDebian buster ä½¿ç”¨çš„æ˜¯ <a href="https://wiki.debian.org/nftables">nftables</a> ä½œä¸º iptables çš„é»˜è®¤åç«¯ï¼Œç„¶è€Œ Docker æœ¬èº«è¿˜ä¸æ”¯æŒ nftablesã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜åªéœ€è¦åœ¨å®¹å™¨é•œåƒä¸­åˆ‡æ¢åˆ° iptables å‘½ä»¤å³å¯ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>RUN update-alternatives --set iptables  /usr/sbin/iptables-legacy <span style="color:#ff79c6">||</span> <span style="color:#8be9fd;font-style:italic">true</span> <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    update-alternatives --set ip6tables /usr/sbin/ip6tables-legacy <span style="color:#ff79c6">||</span> <span style="color:#8be9fd;font-style:italic">true</span> <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    update-alternatives --set arptables /usr/sbin/arptables-legacy <span style="color:#ff79c6">||</span> <span style="color:#8be9fd;font-style:italic">true</span>
</span></span></code></pre></div><p>å®Œæ•´çš„ Dockerfile æ–‡ä»¶å’Œå¯åŠ¨è„šæœ¬å¯ä»¥åœ¨ GitHubï¼ˆ<a href="https://github.com/jieyu/docker-images/tree/master/dind">https://github.com/jieyu/docker-images/tree/master/dind</a>ï¼‰ä¸Šé¢è·å–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>jieyu/dind-buster:v0.1.8</code> è¿™ä¸ªé•œåƒæ¥æµ‹è¯•ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run --rm --privileged jieyu/dind-buster:v0.1.8 docker run alpine wget baidu.com
</span></span></code></pre></div><p>åœ¨ Kubernetes é›†ç¾¤ä¸‹ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„ Pod èµ„æºæ¸…å•éƒ¨ç½²å³å¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">kind</span>: Pod
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">name</span>: dind
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">containers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">image</span>: jieyu/dind-buster:v0.1.8
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">name</span>: dind
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">stdin</span>: <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">tty</span>: <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">args</span>:
</span></span><span style="display:flex;"><span>        - /bin/bash
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ff79c6">mountPath</span>: /var/lib/docker
</span></span><span style="display:flex;"><span>          <span style="color:#ff79c6">name</span>: varlibdocker
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">securityContext</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">privileged</span>: <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">volumes</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: varlibdocker
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">emptyDir</span>: {}
</span></span></code></pre></div><h2 id="åœ¨-pod-ä¸­è¿è¡Œ-kind">åœ¨ Pod ä¸­è¿è¡Œ KinD</h2>
<p>ä¸Šé¢æˆ‘ä»¬æˆåŠŸé…ç½®äº† Docker-in-Docker(DinD)ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥åœ¨è¯¥å®¹å™¨ä¸­ä½¿ç”¨ KinD å¯åŠ¨ Kubernetes é›†ç¾¤ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run -ti --rm --privileged jieyu/dind-buster:v0.1.8 /bin/bash
</span></span><span style="display:flex;"><span>Waiting <span style="color:#ff79c6">for</span> dockerd...
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>root@257b543a91a5 /<span style="color:#ff79c6">]</span><span style="color:#6272a4"># curl -Lso ./kind https://kind.sigs.k8s.io/dl/v0.8.1/kind-$(uname)-amd64</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>root@257b543a91a5 /<span style="color:#ff79c6">]</span><span style="color:#6272a4"># chmod +x ./kind</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>root@257b543a91a5 /<span style="color:#ff79c6">]</span><span style="color:#6272a4"># mv ./kind /usr/bin/</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>root@257b543a91a5 /<span style="color:#ff79c6">]</span><span style="color:#6272a4"># kind create cluster</span>
</span></span><span style="display:flex;"><span>Creating cluster <span style="color:#f1fa8c">&#34;kind&#34;</span> ...
</span></span><span style="display:flex;"><span> âœ“ Ensuring node image <span style="color:#ff79c6">(</span>kindest/node:v1.18.2<span style="color:#ff79c6">)</span> ğŸ–¼
</span></span><span style="display:flex;"><span> âœ“ Preparing nodes ğŸ“¦
</span></span><span style="display:flex;"><span> âœ“ Writing configuration ğŸ“œ
</span></span><span style="display:flex;"><span> âœ“ Starting control-plane ğŸ•¹ï¸
</span></span><span style="display:flex;"><span> âœ“ Installing CNI ğŸ”Œ
</span></span><span style="display:flex;"><span> âœ“ Installing StorageClass ğŸ’¾
</span></span><span style="display:flex;"><span>Set kubectl context to <span style="color:#f1fa8c">&#34;kind-kind&#34;</span>
</span></span><span style="display:flex;"><span>You can now use your cluster with:
</span></span><span style="display:flex;"><span>kubectl cluster-info --context kind-kind
</span></span><span style="display:flex;"><span>Have a nice day! ğŸ‘‹
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>root@257b543a91a5 /<span style="color:#ff79c6">]</span><span style="color:#6272a4"># kubectl get nodes</span>
</span></span><span style="display:flex;"><span>NAME                 STATUS   ROLES    AGE   VERSION
</span></span><span style="display:flex;"><span>kind-control-plane   Ready    master   11m   v1.18.2
</span></span></code></pre></div><p>ç”±äºæŸäº›åŸå› å¯èƒ½ä½ ç”¨ä¸Šé¢çš„å‘½ä»¤ä¸‹è½½ä¸äº† kindï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åŠæ³•æå‰ä¸‹è½½åˆ°å®¿ä¸»æœºä¸Šé¢ï¼Œç„¶åç›´æ¥æŒ‚è½½åˆ°å®¹å™¨ä¸­å»ä¹Ÿå¯ä»¥ï¼Œæˆ‘è¿™é‡Œå°† kind å’Œ kubectl å‘½ä»¤éƒ½æŒ‚è½½åˆ°å®¹å™¨ä¸­å»ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨å®¹å™¨å³å¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run -it --rm --privileged -v /usr/local/bin/kind:/usr/bin/kind -v /usr/local/bin/kubectl:/usr/bin/kubectl jieyu/dind-buster:v0.1.8 /bin/bash
</span></span></code></pre></div><p><img src="https://picdn.youdianzhishi.com/images/20200612100342.png" alt="kind in docker"></p>
<p>å¯ä»¥çœ‹åˆ°åœ¨å®¹å™¨ä¸­å¯ä»¥å¾ˆå¥½çš„ä½¿ç”¨ KinD æ¥åˆ›å»º Kubernetes é›†ç¾¤ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç›´æ¥åœ¨ Kubernetes ä¸­æ¥æµ‹è¯•ä¸€æ¬¡ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl apply -f dind.yaml
</span></span><span style="display:flex;"><span>$ kubectl <span style="color:#8be9fd;font-style:italic">exec</span> -ti dind /bin/bash
</span></span><span style="display:flex;"><span>root@dind:/# curl -Lso ./kind https://kind.sigs.k8s.io/dl/v0.7.0/kind-<span style="color:#ff79c6">$(</span>uname<span style="color:#ff79c6">)</span>-amd64
</span></span><span style="display:flex;"><span>root@dind:/# chmod +x ./kind
</span></span><span style="display:flex;"><span>root@dind:/# mv ./kind /usr/bin/
</span></span><span style="display:flex;"><span>root@dind:/# kind create cluster
</span></span><span style="display:flex;"><span>Creating cluster <span style="color:#f1fa8c">&#34;kind&#34;</span> ...
</span></span><span style="display:flex;"><span> âœ“ Ensuring node image <span style="color:#ff79c6">(</span>kindest/node:v1.17.0<span style="color:#ff79c6">)</span> ğŸ–¼
</span></span><span style="display:flex;"><span> âœ“ Preparing nodes ğŸ“¦
</span></span><span style="display:flex;"><span> âœ“ Writing configuration ğŸ“œ
</span></span><span style="display:flex;"><span> âœ— Starting control-plane ğŸ•¹ï¸
</span></span><span style="display:flex;"><span>ERROR: failed to create cluster: failed to init node with kubeadm: <span style="color:#8be9fd;font-style:italic">command</span> <span style="color:#f1fa8c">&#34;docker exec --privileged kind-control-plane kubeadm init --ignore-preflight-errors=all --config=/kind/kubeadm.conf --skip-token-print --v=6&#34;</span> failed with error: <span style="color:#8be9fd;font-style:italic">exit</span> status <span style="color:#bd93f9">137</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ Pod ä¸­ä½¿ç”¨ KinD æ¥åˆ›å»ºé›†ç¾¤å¤±è´¥äº†ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ KinD èŠ‚ç‚¹åµŒå¥—å®¹å™¨å†…è¿è¡Œçš„ kubelet ä¼šéšæœºæ€æ­»é¡¶å±‚å®¹å™¨å†…çš„è¿›ç¨‹ï¼Œè¿™å…¶å®è¿˜æ˜¯å’Œä¸Šé¢è®¨è®ºçš„ cgroups çš„æŒ‚è½½æœ‰å…³ã€‚</p>
<p>ä½†å…¶å®æˆ‘è‡ªå·±åœ¨ä½¿ç”¨ v0.8.1 ç‰ˆæœ¬çš„ KinD çš„æ—¶å€™ï¼Œåœ¨ä¸Šé¢çš„ Pod ä¸­æ˜¯å¯ä»¥æ­£å¸¸åˆ›å»ºé›†ç¾¤çš„ï¼Œä¸çŸ¥é“æ˜¯å¦æ˜¯ KinD æ­å»ºçš„é›†ç¾¤æœ‰ä»€ä¹ˆç‰¹æ®Šå¤„ç†ï¼Œè¿™é‡Œéœ€è¦å†æ·±å…¥ç ”ç©¶ï¼š</p>
<p><img src="https://picdn.youdianzhishi.com/images/20200612114709.png" alt="kind in pod"></p>
<p>å¦‚æœä½ åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ°äº†ä¸Šè¿°çš„é—®é¢˜ï¼Œåˆ™å¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹è§£å†³æ–¹æ¡ˆã€‚</p>
<p>å½“é¡¶å±‚å®¹å™¨ï¼ˆDINDï¼‰åœ¨ Kubernetes Pod ä¸­è¿è¡Œçš„æ—¶å€™ï¼Œå¯¹äºæ¯ä¸ª cgroup å­ç³»ç»Ÿï¼ˆæ¯”å¦‚å†…å­˜ï¼‰ï¼Œä»å®¿ä¸»æœºçš„è§’åº¦æ¥çœ‹ï¼Œå®ƒçš„ cgroup è·¯å¾„æ˜¯ <code>/kubepods/burstable/&lt;POD_ID&gt;/&lt;DIND_CID&gt;</code>ã€‚</p>
<p>å½“ KinD åœ¨ DIND å®¹å™¨å†…çš„åµŒå¥—èŠ‚ç‚¹å®¹å™¨å†…å¯åŠ¨ kubelet çš„æ—¶å€™ï¼Œkubelet å°†åœ¨ <code>/kubepods/burstable/</code> ä¸‹ç›¸å¯¹äºåµŒå¥— KIND èŠ‚ç‚¹å®¹å™¨çš„æ ¹ cgroup ä¸ºå…¶ Pods æ¥æ“ä½œ cgroupã€‚ä»å®¿ä¸»æœºçš„è§’åº¦æ¥çœ‹ï¼Œcgroup è·¯å¾„å°±æ˜¯ <code>/kubepods/burstable/&lt;POD_ID&gt;/&lt;DIND_CID&gt;/docker/&lt;KIND_CID&gt;/kubepods/burstable/</code>ã€‚</p>
<p>è¿™äº›éƒ½æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯åœ¨åµŒå¥—çš„ KinD èŠ‚ç‚¹å®¹å™¨ä¸­ï¼Œæœ‰å¦ä¸€ä¸ª cgroup å­˜åœ¨äº <code>/kubepods/burstable/&lt;POD_ID&gt;/&lt;DIND_CID&gt;/docker/&lt;DIND_CID&gt;</code>ä¸‹é¢ï¼Œç›¸å¯¹äºåµŒå¥—çš„ KinD èŠ‚ç‚¹å®¹å™¨çš„æ ¹ cgroupï¼Œåœ¨ kubelet å¯åŠ¨ä¹‹å‰å°±å­˜åœ¨äº†ï¼Œè¿™æ˜¯ä¸Šé¢æˆ‘ä»¬è®¨è®ºè¿‡çš„ cgroups æŒ‚è½½é€ æˆçš„ï¼Œé€šè¿‡ KinD entrypoint è„šæœ¬è®¾ç½®ã€‚è€Œå¦‚æœä½ åœ¨ KinD èŠ‚ç‚¹å®¹å™¨é‡Œé¢åšä¸€ä¸ª <code>cat /kubepods/burstable/&lt;POD_ID&gt;/docker/&lt;DIND_CID&gt;/tasks</code>ï¼Œä½ ä¼šçœ‹åˆ° DinD å®¹å™¨çš„è¿›ç¨‹ã€‚</p>
<p><img src="https://picdn.youdianzhishi.com/images/20200612111432.png" alt="k8s in k8s"></p>
<p>è¿™å°±æ˜¯æœ€æ ¹æœ¬çš„åŸå› ï¼ŒKinD èŠ‚ç‚¹å®¹å™¨é‡Œé¢çš„ kubelet çœ‹åˆ°äº†è¿™ä¸ª cgroupï¼Œä»¥ä¸ºåº”è¯¥ç”±å®ƒæ¥ç®¡ç†ï¼Œä½†æ˜¯å´æ‰¾ä¸åˆ°å’Œè¿™ä¸ª cgroup ç›¸å…³è”çš„ Podï¼Œæ‰€ä»¥å°±ä¼šå°è¯•æ¥æ€æ­»å±äºè¿™ä¸ª cgroup çš„è¿›ç¨‹æ¥åˆ é™¤è¿™ä¸ª cgroupã€‚è¿™ä¸ªæ“ä½œçš„ç»“æœå°±æ˜¯éšæœºè¿›ç¨‹è¢«æ€æ­»ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•å¯ä»¥é€šè¿‡è®¾ç½® kubelet çš„<code>--cgroup-root</code> å‚æ•°ï¼Œé€šè¿‡è¯¥æ ‡å¿—æ¥æŒ‡ç¤º KinD èŠ‚ç‚¹å®¹å™¨å†…çš„ kubelet ä¸ºå…¶ Pods ä½¿ç”¨ä¸é€šçš„ cgroup æ ¹è·¯å¾„ï¼ˆæ¯”å¦‚ /kubeletï¼‰ã€‚è¿™æ ·å°±å¯ä»¥åœ¨ Kubernetes é›†ç¾¤ä¸­æ¥å¯åŠ¨ KinD é›†ç¾¤äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„ YAML èµ„æºæ¸…å•æ–‡ä»¶æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">kind</span>: Pod
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">name</span>: kind-cluster
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">containers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">image</span>: jieyu/kind-cluster-buster:v0.1.0
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">name</span>: kind-cluster
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">stdin</span>: <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">tty</span>: <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">args</span>:
</span></span><span style="display:flex;"><span>        - /bin/bash
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">env</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ff79c6">name</span>: API_SERVER_ADDRESS
</span></span><span style="display:flex;"><span>          <span style="color:#ff79c6">valueFrom</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">fieldRef</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#ff79c6">fieldPath</span>: status.podIP
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ff79c6">mountPath</span>: /var/lib/docker
</span></span><span style="display:flex;"><span>          <span style="color:#ff79c6">name</span>: varlibdocker
</span></span><span style="display:flex;"><span>        - <span style="color:#ff79c6">mountPath</span>: /lib/modules
</span></span><span style="display:flex;"><span>          <span style="color:#ff79c6">name</span>: libmodules
</span></span><span style="display:flex;"><span>          <span style="color:#ff79c6">readOnly</span>: <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">securityContext</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">privileged</span>: <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ff79c6">containerPort</span>: <span style="color:#bd93f9">30001</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ff79c6">name</span>: api-server-port
</span></span><span style="display:flex;"><span>          <span style="color:#ff79c6">protocol</span>: TCP
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">readinessProbe</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">failureThreshold</span>: <span style="color:#bd93f9">15</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">httpGet</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ff79c6">path</span>: /healthz
</span></span><span style="display:flex;"><span>          <span style="color:#ff79c6">port</span>: api-server-port
</span></span><span style="display:flex;"><span>          <span style="color:#ff79c6">scheme</span>: HTTPS
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">initialDelaySeconds</span>: <span style="color:#bd93f9">120</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">periodSeconds</span>: <span style="color:#bd93f9">20</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">successThreshold</span>: <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">timeoutSeconds</span>: <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">volumes</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: varlibdocker
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">emptyDir</span>: {}
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: libmodules
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">hostPath</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">path</span>: /lib/modules
</span></span></code></pre></div><p>ä½¿ç”¨ä¸Šé¢çš„èµ„æºæ¸…å•æ–‡ä»¶åˆ›å»ºå®Œæˆåï¼Œç¨ç­‰ä¸€ä¼šå„¿æˆ‘ä»¬å°±å¯ä»¥è¿›å…¥ Pod ä¸­æ¥éªŒè¯ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl <span style="color:#8be9fd;font-style:italic">exec</span> -ti kind-cluster /bin/bash
</span></span><span style="display:flex;"><span>root@kind-cluster:/# kubectl get nodes
</span></span><span style="display:flex;"><span>NAME                 STATUS   ROLES    AGE   VERSION
</span></span><span style="display:flex;"><span>kind-control-plane   Ready    master   72s   v1.17.0
</span></span></code></pre></div><p>åŒæ ·ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Docker CLI æ¥è¿›è¡Œæµ‹è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run -ti --rm --privileged jieyu/kind-cluster-buster:v0.1.0 /bin/bash
</span></span><span style="display:flex;"><span>Waiting <span style="color:#ff79c6">for</span> dockerd...
</span></span><span style="display:flex;"><span>Setting up KIND cluster
</span></span><span style="display:flex;"><span>Creating cluster <span style="color:#f1fa8c">&#34;kind&#34;</span> ...
</span></span><span style="display:flex;"><span> âœ“ Ensuring node image <span style="color:#ff79c6">(</span>jieyu/kind-node:v1.17.0<span style="color:#ff79c6">)</span> ğŸ–¼
</span></span><span style="display:flex;"><span> âœ“ Preparing nodes ğŸ“¦
</span></span><span style="display:flex;"><span> âœ“ Writing configuration ğŸ“œ
</span></span><span style="display:flex;"><span> âœ“ Starting control-plane ğŸ•¹ï¸
</span></span><span style="display:flex;"><span> âœ“ Installing CNI ğŸ”Œ
</span></span><span style="display:flex;"><span> âœ“ Installing StorageClass ğŸ’¾
</span></span><span style="display:flex;"><span> âœ“ Waiting â‰¤ 15m0s <span style="color:#ff79c6">for</span> control-plane <span style="color:#ff79c6">=</span> Ready â³
</span></span><span style="display:flex;"><span> â€¢ Ready after 31s ğŸ’š
</span></span><span style="display:flex;"><span>Set kubectl context to <span style="color:#f1fa8c">&#34;kind-kind&#34;</span>
</span></span><span style="display:flex;"><span>You can now use your cluster with:
</span></span><span style="display:flex;"><span>kubectl cluster-info --context kind-kind
</span></span><span style="display:flex;"><span>Have a nice day! ğŸ‘‹
</span></span><span style="display:flex;"><span>root@d95fa1302557:/# kubectl get nodes
</span></span><span style="display:flex;"><span>NAME                 STATUS   ROLES    AGE   VERSION
</span></span><span style="display:flex;"><span>kind-control-plane   Ready    master   71s   v1.17.0
</span></span><span style="display:flex;"><span>root@d95fa1302557:/#
</span></span></code></pre></div><blockquote>
<p>ä¸Šé¢é•œåƒå¯¹åº”çš„ Dockerfile å’Œå¯åŠ¨è„šæœ¬åœ°å€ï¼š<a href="https://github.com/jieyu/docker-images/tree/master/kind-cluster">https://github.com/jieyu/docker-images/tree/master/kind-cluster</a></p>
</blockquote>
<p>ä¸‹å›¾æ˜¯æˆ‘åœ¨ KinD æ­å»ºçš„ Kubernetes é›†ç¾¤ä¸­ï¼Œåˆ›å»ºçš„ä¸€ä¸ª Podï¼Œç„¶ååœ¨ Pod ä¸­åˆ›å»ºçš„ä¸€ä¸ªç‹¬ç«‹çš„ Kubernetes é›†ç¾¤æœ€ç»ˆæ•ˆæœï¼š</p>
<p><img src="https://picdn.youdianzhishi.com/images/20200612115324.png" alt="k8s in k8s"></p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>åœ¨å®ç°ä¸Šé¢åŠŸèƒ½çš„æ—¶å€™ï¼Œè¿‡ç¨‹ä¸­è¿˜æ˜¯é‡åˆ°äº†ä¸å°‘çš„éšœç¢ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯å› ä¸º Docker å®¹å™¨æ²¡æœ‰æä¾›å’Œå®¿ä¸»æœºå®Œå…¨éš”ç¦»çš„åŠŸèƒ½é€ æˆçš„ï¼ŒæŸäº›å†…æ ¸èµ„æºæ¯”å¦‚ cgroups æ˜¯åœ¨å†…æ ¸ä¸­å…±äº«çš„ï¼Œå¦‚æœå¾ˆå¤šå®¹å™¨åŒæ—¶æ“ä½œå®ƒä»¬ï¼Œä¹Ÿå¯èƒ½ä¼šé€ æˆæ½œåœ¨çš„å†²çªã€‚ä½†æ˜¯ä¸€æ—¦è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥éå¸¸æ–¹ä¾¿çš„åœ¨ Kubernetes é›†ç¾¤ Pod ä¸­è½»æ¾åœ°è¿è¡Œä¸€ä¸ªç‹¬ç«‹çš„ Kubernetes é›†ç¾¤äº†ï¼Œè¿™åº”è¯¥ç®—çœŸæ­£çš„ Kubernetes IN Kubernetes äº†å§~</p>
<blockquote>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://d2iq.com/blog/running-kind-inside-a-kubernetes-cluster-for-continuous-integration?utm_sq=gf2bqwb34d">https://d2iq.com/blog/running-kind-inside-a-kubernetes-cluster-for-continuous-integration</a></p>
</blockquote>
<!-- raw HTML omitted -->

          <h2>å¾®ä¿¡å…¬ä¼—å·</h2>
<p>
  æ‰«æä¸‹é¢çš„äºŒç»´ç å…³æ³¨æˆ‘ä»¬çš„å¾®ä¿¡å…¬ä¼—å¸å·ï¼Œåœ¨å¾®ä¿¡å…¬ä¼—å¸å·ä¸­å›å¤â—‰åŠ ç¾¤â—‰å³å¯åŠ å…¥åˆ°æˆ‘ä»¬çš„
  kubernetes è®¨è®ºç¾¤é‡Œé¢å…±åŒå­¦ä¹ ã€‚
</p>
<img
  src="https://picdn.youdianzhishi.com/images/qrcode.png"
  alt="wechat-account-qrcode"
/>

  
          
            <div class="entry-shang text-center">
    <p>ã€ŒçœŸè¯šèµèµï¼Œæ‰‹ç•™ä½™é¦™ã€</p>
    <button class="zs show-zs btn btn-bred">èµèµ</button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
    <div class="zs-modal-head">
        <button type="button" class="close">Ã—</button>
        <span class="author"><img src="https://www.qikqiak.com/img/avatar.jpeg"/>é˜³æ˜</span>
        <p class="tip"><i></i><span>è¯·æˆ‘å–æ¯å’–å•¡ï¼Ÿ</span></p>
    </div>
    <div class="zs-modal-body">
        <div class="zs-modal-btns">
            <button class="btn btn-blink" data-num="2">2å…ƒ</button>
            <button class="btn btn-blink" data-num="5">5å…ƒ</button>
            <button class="btn btn-blink" data-num="10">10å…ƒ</button>
            <button class="btn btn-blink" data-num="50">50å…ƒ</button>
            <button class="btn btn-blink" data-num="100">100å…ƒ</button>
            <button class="btn btn-blink" data-num="1">ä»»æ„é‡‘é¢</button>
        </div>
        <div class="zs-modal-pay">
            <button class="btn btn-bred" id="pay-text">2å…ƒ</button>
            <p>ä½¿ç”¨<span id="pay-type">å¾®ä¿¡</span>æ‰«æäºŒç»´ç å®Œæˆæ”¯ä»˜</p>
            <img src="https://www.qikqiak.com/img/wechat-2.png" id="pay-image"/>
        </div>
    </div>
    <div class="zs-modal-footer">
        <span class="zs-wechat"><img src="https://www.qikqiak.com/img/wechat-btn.png"/></span>
    </div>
</div>
          
          
            <div class="social-share" data-initialized="true" style="margin-bottom: 20px;margin-top:20px;">
    <center>
    <a href="#" class="social-share-icon icon-weibo"></a>
    <a href="#" class="social-share-icon icon-wechat"></a>
    <a href="#" class="social-share-icon icon-twitter"></a>
    <a href="#" class="social-share-icon icon-linkedin"></a>
    <a href="#" class="social-share-icon icon-facebook"></a>
    <a href="#" class="social-share-icon icon-qq"></a>
    <a href="#" class="social-share-icon icon-qzone"></a>
    </center>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>

          
        </article>
  
        
          

<h3>ç›¸å…³æ–‡ç« </h3>
<ul style="margin-bottom: 25px;">
    
    <li><a href="https://www.qikqiak.com/post/deploy-k8s-on-win-use-wsl2/">åœ¨ Windows ä¸‹ä½¿ç”¨ WSL2 æ­å»º Kubernetes é›†ç¾¤</a></li>
    
    <li><a href="https://www.qikqiak.com/post/speed-up-develop-flow-dockerfile-best-practices/">åŠ é€Ÿå¼€å‘æµç¨‹çš„ Dockerfile æœ€ä½³å®è·µ</a></li>
    
    <li><a href="https://www.qikqiak.com/post/get-client-realip/">è·å–å®¢æˆ·ç«¯è®¿é—®çœŸå® IP</a></li>
    
    <li><a href="https://www.qikqiak.com/post/capabilities-on-k8s/">åœ¨ Kubernetes ä¸­é…ç½® Container Capabilities</a></li>
    
    <li><a href="https://www.qikqiak.com/post/gitlab-install-on-k8s/">åœ¨ Kubernetes ä¸Šå®‰è£… Gitlab</a></li>
    
    <li><a href="https://www.qikqiak.com/post/harbor-quick-install/">åœ¨ Kubernetes åœ¨å¿«é€Ÿå®‰è£… Harbor</a></li>
    
    <li><a href="https://www.qikqiak.com/post/harbor-code-analysis/">Harbor æºç æµ…æ</a></li>
    
    <li><a href="https://www.qikqiak.com/post/dockerfile-best-practice/">Dockerfile æœ€ä½³å®è·µ</a></li>
    
    <li><a href="https://www.qikqiak.com/post/pod-init-container/">åˆå§‹åŒ–å®¹å™¨</a></li>
    
    <li><a href="https://www.qikqiak.com/post/write-kubernets-golang-service-step-by-step/">æ‰‹æ‘¸æ‰‹æ•™ä½ å†™ Kubernetes çš„ golang æœåŠ¡</a></li>
    
</ul>

        
  
        
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://www.qikqiak.com/post/deploy-k8s-on-win-use-wsl2/" data-toggle="tooltip" data-placement="top" title="åœ¨ Windows ä¸‹ä½¿ç”¨ WSL2 æ­å»º Kubernetes é›†ç¾¤">&larr; å‰ä¸€ç¯‡</a>
            </li>
          
          
            <li class="next">
              <a href="https://www.qikqiak.com/post/status-in-pv-pvc/" data-toggle="tooltip" data-placement="top" title="Kubernetes ä¸­ PV å’Œ PVC çš„çŠ¶æ€å˜åŒ–">åä¸€ç¯‡ &rarr;</a>
            </li>
          
        </ul>
        

        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        
        <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-5376999672787220"
            data-ad-slot="3700507799"
            data-ad-format="auto"
            data-full-width-responsive="true"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
  
        
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
    var gitalk = new Gitalk({
        clientID: 'bdb76dbb2e9d0786e350',
        clientSecret: 'b454b2a08013fd0e32013be7a63fa8fcb262b6c4',
        repo: 'blog',
        owner: 'cnych',
        admin: ['cnych'],
        labels: ['gitment'],
        title: 'åœ¨ Kubernetes ä¸­è¿è¡Œ Kubernetes',
        createIssueManually: true,
        id: 'k8s-in-k8s',      
        distractionFreeMode: true  
    });
    gitalk.render('gitalk-container');
</script>


        
          

        
  
      </div>
    
    
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          <img src="https://www.qikqiak.com/img/wechatmp.png" alt="k8sæŠ€æœ¯åœˆ">
          
              <li>
                <a href="mailto:icnych@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
              <li>
                <a href="https://github.com/cnych" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
              <li>
                <a href="https://weibo.com/cnych" title="å¾®åš">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
              <li>
                <a href="https://instagram.com/cnych" title="Instagram">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          
          <li>
            <a href="https://www.qikqiak.com/index.xml" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;
          2023

          
            &nbsp;&bull;&nbsp;
            <a href="https://www.qikqiak.com/">é˜³æ˜çš„åšå®¢</a>
            &nbsp;&bull;&nbsp;
            <a href="https://www.qikqiak.com/sitemap.xml">ç½‘ç«™åœ°å›¾</a>
            &nbsp;&bull;&nbsp;
            <a href="https://www.qikqiak.com/page/archive/">å½’æ¡£</a>
            &nbsp;&bull;&nbsp;
            <a href="https://www.qikqiak.com/page/friend/">å‹é“¾</a>
            &nbsp;&bull;&nbsp;
            <a href="https://beian.miit.gov.cn/" target="_blank">èœ€ICPå¤‡11027319å·-5</a>
            <a class="h" href="https://www.qikqiak.com/page/kubernetes.io">kubernetes.io</a>
            <a class="h" href="https://www.qikqiak.com/page/kubernetes.org.cn">Kubernetesä¸­æ–‡ç¤¾åŒº</a>
          
        </p>
        <p class="text-center text-muted">
          <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
          <span id="busuanzi_container_site_pv" style="display:none">
            æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
          </span>
          &nbsp;&bull;&nbsp;
          <span id="busuanzi_container_site_uv" style="display:none">
            è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äººæ¬¡
          </span>
        </p>
        
        <p class="credits theme-by text-muted">
          ç”± <a href="http://gohugo.io">Hugo v0.115.4</a> å¼ºåŠ›é©±åŠ¨ &nbsp;&bull;&nbsp; ä¸»é¢˜ <a href="https://github.com/cnych/qikqiak.com">qikqiak-blog</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>


<script src='https://www.qikqiak.com/js/bundle.min.af02a2d23b6651a566f0135a12e65fc2560faa7a969b3d1ad58d0afe0c9164ae.js' integrity='sha256-rwKi0jtmUaVm8BNaEuZfwlYPqnqWmz0a1Y0K/gyRZK4='></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-69668147-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-69668147-3');
</script>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script >
$(document).ready(function() {
  var int = setInterval(fixCount, 50);  
  
  var initPVCount = 584976;
  var initUVCount = 153191;
  function fixCount() {                   
    if ($("#busuanzi_container_site_pv").css("display") != "none") {
        $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + initPVCount); 
        clearInterval(int); 
    }
    if ($("#busuanzi_container_site_uv").css("display") != "none") {
      $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + initUVCount);
      clearInterval(int); 
    }  
  }           
});
</script>
 <script>(function(w,d, s, id) {if(typeof(w.webpushr)!=='undefined') return;w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.src = "https://cdn.webpushr.com/app.min.js";fjs.parentNode.appendChild(js);}(window,document, 'script', 'webpushr-jssdk'));webpushr('init','BJICPtxnbz-7vq9kEwH5psPCuHe2CvludQug4R2tuJGPF0GQT2hwSWTAhlSt2EFD5InpuQyxCGJdigf6-KbQ53c');</script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery-migrate@1.2.1/dist/jquery-migrate.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
<script type="text/javascript">
$('.carousel').slick({
    dots: true,
    arrows: true,
    autoplay: true,
    autoplaySpeed: 4000,
    infinite: true,
    speed: 500,
    fade: true,
    cssEase: 'linear',
    centerMode: true,
    prevArrow: '<button type="button" class="slick-prev"></button>',
    nextArrow: '<button type="button" class="slick-next"></button>',
});
</script>

  </body>
</html>

